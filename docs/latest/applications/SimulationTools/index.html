<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
---
layout: default
---

<div class="docs-container container-fluid">
  <div class="row">
    <nav class="sidebar-nav hidden-sm-down col-md-3 col-lg-3">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<aside class="sidebar">
  <ul>
    
    <section class="sidebar-group">
      <h4>Getting started</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/getting-started/LocalCluster/"><i class="fa fa-file-text-o"></i>Run Pulsar locally</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/getting-started/Clients/"><i class="fa fa-file-text-o"></i>Client libraries</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/getting-started/ConceptsAndArchitecture/"><i class="fa fa-file-text-o"></i>Concepts and architecture</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Deployment</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/deployment/InstanceSetup/"><i class="fa fa-file-text-o"></i>Deploying a Pulsar instance</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/deployment/Kubernetes/"><i class="fa fa-file-text-o"></i>Pulsar on Kubernetes</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Concerns</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/concerns/PartitionedTopics/"><i class="fa fa-file-text-o"></i>Partitioned topics</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/concerns/RetentionExpiry/"><i class="fa fa-file-text-o"></i>Retention and expiry</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Pulsar administration</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/AdminInterface/"><i class="fa fa-file-text-o"></i>Pulsar admin interface</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/ClustersBrokers/"><i class="fa fa-file-text-o"></i>Clusters and brokers</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/PropertiesNamespaces/"><i class="fa fa-file-text-o"></i>Properties and namespaces</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/ZooKeeperBookKeeper/"><i class="fa fa-file-text-o"></i>ZooKeeper and BookKeeper</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/Dashboard/"><i class="fa fa-file-text-o"></i>Dashboard</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/Authz/"><i class="fa fa-file-text-o"></i>Authentication and authorization</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/GeoReplication/"><i class="fa fa-file-text-o"></i>Geo-replication</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/Stats/"><i class="fa fa-file-text-o"></i>Pulsar statistics</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/ModularLoadManager/"><i class="fa fa-file-text-o"></i>Modular load manager</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Pulsar applications</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/JavaClient/"><i class="fa fa-file-text-o"></i>The Pulsar Java client</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/CppClient/"><i class="fa fa-file-text-o"></i>The Pulsar C++ client</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/PythonClient/"><i class="fa fa-file-text-o"></i>The Pulsar Python client</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/WebSocket/"><i class="fa fa-file-text-o"></i>WebSocket API</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/PulsarSpark/"><i class="fa fa-file-text-o"></i>Spark Streaming receiver</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/PulsarStorm/"><i class="fa fa-file-text-o"></i>Apache Storm adaptor</a></li>
        
        
        
        <li><a  class="active"
                href="/incubator-pulsar/docs/latest/applications/SimulationTools/"><i class="fa fa-file-text-o"></i>Simulation tools</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Developing Pulsar</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/project/BinaryProtocol/"><i class="fa fa-file-text-o"></i>Pulsar binary protocol</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/project/Codebase/"><i class="fa fa-file-text-o"></i>Codebase</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Reference</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/reference/RestApi/"><i class="fa fa-file-text-o"></i>Pulsar REST API</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/reference/CliTools/"><i class="fa fa-file-text-o"></i>Command-line tools</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/reference/Configuration/"><i class="fa fa-file-text-o"></i>Pulsar configuration</a></li>
        
      </ul>
    </section>
    
  </ul>
</aside>


    </nav>

    <article class="col-xs-12 col-sm-12 col-md-7 col-lg-7">
      <section class="docs-header">
        <h1 class="docs-title">Simulation tools</h1>
        
        <section class="tags">
          
          <!-- <span class="badge badge-pill badge-primary">simulation</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-simulation">simulation</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-simulation">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pages with the <strong>simulation</strong> tag</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/latest/applications/SimulationTools/">Simulation tools</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
        </section>

        <hr class="hr">
      </section>

      <section class="content">
        <p>It is sometimes necessary create an test environment and incur artificial load to observe how well load managers
handle the load. The load simulation controller, the load simulation client, and the broker monitor were created as an
effort to make create this load and observe the effects on the managers more easily.</p>

<h2 id="simulation-client">Simulation Client</h2>
<p>The simulation client is a machine which will create and subscribe to topics with configurable message rates and sizes.
Because it is sometimes necessary in simulating large load to use multiple client machines, the user does not interact
with the simulation client directly, but instead delegates their requests to the simulation controller, which will then
send signals to clients to start incurring load. The client implementation is in the class
<code class="highlighter-rouge">org.apache.pulsar.testclient.LoadSimulationClient</code>.</p>

<h3 id="usage">Usage</h3>
<p>To Start a simulation client, use the <code class="highlighter-rouge">pulsar-perf</code> script with the command <code class="highlighter-rouge">simulation-client</code> as follows:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pulsar-perf simulation-client --port &lt;listen port&gt; --service-url &lt;pulsar service url&gt;
</code></pre>
</div>

<p>The client will then be ready to receive controller commands.</p>
<h2 id="simulation-controller">Simulation Controller</h2>
<p>The simulation controller send signals to the simulation clients, requesting them to create new topics, stop old
topics, change the load incurred by topics, as well as several other tasks. It is implemented in the class
<code class="highlighter-rouge">org.apache.pulsar.testclient.LoadSimulationController</code> and presents a shell to the user as an interface to send
command with.</p>

<h3 id="usage-1">Usage</h3>
<p>To start a simulation controller, use the <code class="highlighter-rouge">pulsar-perf</code> script with the command <code class="highlighter-rouge">simulation-controller</code> as follows:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pulsar-perf simulation-controller --cluster &lt;cluster to simulate on&gt; --client-port &lt;listen port for clients&gt;
--clients &lt;comma-separated list of client host names&gt;
</code></pre>
</div>

<p>The clients should already be started before the controller is started. You will then be presented with a simple prompt,
where you can issue commands to simulation clients. Arguments often refer to tenant names, namespace names, and topic
names. In all cases, the BASE name of the tenants, namespaces, and topics are used. For example, for the topic
<code class="highlighter-rouge">persistent://my_cluster/my_tenant/my_namespace/my_topic</code>, the tenant name is <code class="highlighter-rouge">my_tenant</code>, the namespace name is
<code class="highlighter-rouge">my_namespace</code>, and the topic name is <code class="highlighter-rouge">my_topic</code>. The controller can perform the following actions:</p>

<ul>
  <li>Create a topic with a producer and a consumer
    <ul>
      <li><code class="highlighter-rouge">trade &lt;tenant&gt; &lt;namespace&gt; &lt;topic&gt; [--rate &lt;message rate per second&gt;]
  [--rand-rate &lt;lower bound&gt;,&lt;upper bound&gt;]
  [--size &lt;message size in bytes&gt;]</code></li>
    </ul>
  </li>
  <li>Create a group of topics with a producer and a consumer
    <ul>
      <li><code class="highlighter-rouge">trade_group &lt;tenant&gt; &lt;group&gt; &lt;num_namespaces&gt; [--rate &lt;message rate per second&gt;]
  [--rand-rate &lt;lower bound&gt;,&lt;upper bound&gt;]
  [--separation &lt;separation between creating topics in ms&gt;] [--size &lt;message size in bytes&gt;]
  [--topics-per-namespace &lt;number of topics to create per namespace&gt;]</code></li>
    </ul>
  </li>
  <li>Change the configuration of an existing topic
    <ul>
      <li><code class="highlighter-rouge">change &lt;tenant&gt; &lt;namespace&gt; &lt;topic&gt; [--rate &lt;message rate per second&gt;]
  [--rand-rate &lt;lower bound&gt;,&lt;upper bound&gt;]
  [--size &lt;message size in bytes&gt;]</code></li>
    </ul>
  </li>
  <li>Change the configuration of a group of topics
    <ul>
      <li><code class="highlighter-rouge">change_group &lt;tenant&gt; &lt;group&gt; [--rate &lt;message rate per second&gt;] [--rand-rate &lt;lower bound&gt;,&lt;upper bound&gt;]
  [--size &lt;message size in bytes&gt;] [--topics-per-namespace &lt;number of topics to create per namespace&gt;]</code></li>
    </ul>
  </li>
  <li>Shutdown a previously created topic
    <ul>
      <li><code class="highlighter-rouge">stop &lt;tenant&gt; &lt;namespace&gt; &lt;topic&gt;</code></li>
    </ul>
  </li>
  <li>Shutdown a previously created group of topics
    <ul>
      <li><code class="highlighter-rouge">stop_group &lt;tenant&gt; &lt;group&gt;</code></li>
    </ul>
  </li>
  <li>Copy the historical data from one ZooKeeper to another and simulate based on the message rates and sizes in that
history
    <ul>
      <li><code class="highlighter-rouge">copy &lt;tenant&gt; &lt;source zookeeper&gt; &lt;target zookeeper&gt; [--rate-multiplier value]</code></li>
    </ul>
  </li>
  <li>Simulate the load of the historical data on the current ZooKeeper (should be same ZooKeeper being simulated on)
    <ul>
      <li><code class="highlighter-rouge">simulate &lt;tenant&gt; &lt;zookeeper&gt; [--rate-multiplier value]</code></li>
    </ul>
  </li>
  <li>Stream the latest data from the given active ZooKeeper to simulate the real-time load of that ZooKeeper.
    <ul>
      <li><code class="highlighter-rouge">stream &lt;tenant&gt; &lt;zookeeper&gt; [--rate-multiplier value]</code></li>
    </ul>
  </li>
</ul>

<p>The “group” arguments in these commands allow the user to create or affect multiple topics at once. Groups are created
when calling the <code class="highlighter-rouge">trade_group</code> command, and all topics from these groups may be subsequently modified or stopped
with the <code class="highlighter-rouge">change_group</code> and <code class="highlighter-rouge">stop_group</code> commands respectively. All ZooKeeper arguments are of the form
<code class="highlighter-rouge">zookeeper_host:port</code>.</p>

<h4 id="difference-between-copy-simulate-and-stream">Difference Between Copy, Simulate, and Stream</h4>
<p>The commands <code class="highlighter-rouge">copy</code>, <code class="highlighter-rouge">simulate</code>, and <code class="highlighter-rouge">stream</code> are very similar but have significant differences. <code class="highlighter-rouge">copy</code> is used when
you want to simulate the load of a static, external ZooKeeper on the ZooKeeper you are simulating on. Thus,
<code class="highlighter-rouge">source zookeeper</code> should be the ZooKeeper you want to copy and <code class="highlighter-rouge">target zookeeper</code> should be the ZooKeeper you are
simulating on, and then it will get the full benefit of the historical data of the source in both load manager
implementations. <code class="highlighter-rouge">simulate</code> on the other hand takes in only one ZooKeeper, the one you are simulating on. It assumes
that you are simulating on a ZooKeeper that has historical data for <code class="highlighter-rouge">SimpleLoadManagerImpl</code> and creates equivalent
historical data for <code class="highlighter-rouge">ModularLoadManagerImpl</code>. Then, the load according to the historical data is simulated by the
clients. Finally, <code class="highlighter-rouge">stream</code> takes in an active ZooKeeper different than the ZooKeeper being simulated on and streams
load data from it and simulates the real-time load. In all cases, the optional <code class="highlighter-rouge">rate-multiplier</code> argument allows the
user to simulate some proportion of the load. For instance, using <code class="highlighter-rouge">--rate-multiplier 0.05</code> will cause messages to
be sent at only <code class="highlighter-rouge">5%</code> of the rate of the load that is being simulated.</p>

<h2 id="broker-monitor">Broker Monitor</h2>
<p>To observe the behavior of the load manager in these simulations, one may utilize the broker monitor, which is
implemented in <code class="highlighter-rouge">org.apache.pulsar.testclient.BrokerMonitor</code>. The broker monitor will print tabular load data to the
console as it is updated using watchers.</p>

<h3 id="usage-2">Usage</h3>
<p>To start a broker monitor, use the <code class="highlighter-rouge">monitor-brokers</code> command in the <code class="highlighter-rouge">pulsar-perf</code> script:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pulsar-perf monitor-brokers --connect-string &lt;zookeeper host:port&gt;
</code></pre>
</div>

<p>The console will then continuously print load data until it is interrupted.</p>

      </section>
    </article>

    <nav class="toc-bar hidden-sm-down col-md-2 col-lg-2">
      
      <div id="toc">
        <h4>Simulation tools</h4>
      </div>
      
    </nav>
  </div>
</div>
