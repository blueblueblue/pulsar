<!DOCTYPE html>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<html>
  <head>
    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -108) };
  window.addEventListener("hashchange", shiftWindow);
  window.addEventListener("pageshow", shiftWindow);
  function load() { if (window.location.hash) shiftWindow(); }
</script>

<title>Message retention and expiry</title>

<link rel="stylesheet" href="/incubator-pulsar/css/style.css">
<link rel="shortcut icon" href="/incubator-pulsar/img/favicon.ico">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="/incubator-pulsar/js/jquery.tocify.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

<script async src="/incubator-pulsar/js/main.js"></script>

  </head>
  <body class="body">
    <main class="main">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<nav class="navbar navbar-toggleable-md navbar-light container-fluid sticky-top">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

 
  <a class="navbar-brand" href="/incubator-pulsar/">
    <img class="main-logo" src="/incubator-pulsar/img/pulsar-logo.png" alt="Pulsar logo">
  </a>
  

  <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
    <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/incubator-pulsar/docs/latest">Documentation</a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="/incubator-pulsar/download">Download</a>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="clientLibsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Client libraries
          </a>
          <div class="dropdown-menu" aria-labelledby="clientLibsDropdown">
            <a class="dropdown-item" href="/incubator-pulsar/docs/latest/applications/JavaClient">
              Java
            </a>
            <a class="dropdown-item" href="/incubator-pulsar/docs/latest/applications/PythonClient">
              Python
            </a>
            <a class="dropdown-item" href="/incubator-pulsar/docs/latest/applications/CppClient">
              C++
            </a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="/api/client">
              Java client Javadoc
            </a>
            <a class="dropdown-item" href="/api/admin">
              Java admin Javadoc
            </a>
            <a class="dropdown-item" href="/api/python">
              Python API docs
            </a>
            <a class="dropdown-item" href="/api/cpp">
              C++ API docs
            </a>
          </div>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="versionsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Community
          </a>
          <div class="dropdown-menu" aria-labelledby="versionsDropdown">
              <a class="dropdown-item" href="/incubator-pulsar/mailing-lists">Mailing Lists</a>
              <a class="dropdown-item" href="https://twitter.com/Apache_Pulsar">Twitter</a>
              <a class="dropdown-item" href="https://github.com/apache/incubator-pulsar/wiki">Wiki</a>
              <a class="dropdown-item" href="https://github.com/apache/incubator-pulsar/issues">Issue tracking</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="/incubator-pulsar/presentations">Presentations</a>
            <a class="dropdown-item" href="/incubator-pulsar/team">Team</a>
          </div>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="http://www.apache.org/">
                <img title="Apache Software Foundation" src="/incubator-pulsar/img/feather.png" height="48px" />
            </a>
        </li>
    </ul>
  </div>
</nav>


      <main>
        <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->


<div class="docs-container container-fluid">
  <div class="row">
    <nav class="sidebar-nav hidden-sm-down col-md-3 col-lg-3">
      <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->

<aside class="sidebar">
  <ul>
    
    <section class="sidebar-group">
      <h4>Getting started</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/getting-started/LocalCluster/"><i class="fa fa-file-text-o"></i>Run Pulsar locally</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/getting-started/Clients/"><i class="fa fa-file-text-o"></i>Client libraries</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/getting-started/ConceptsAndArchitecture/"><i class="fa fa-file-text-o"></i>Concepts and architecture</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Deployment</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/deployment/InstanceSetup/"><i class="fa fa-file-text-o"></i>Deploying a Pulsar instance</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/deployment/Kubernetes/"><i class="fa fa-file-text-o"></i>Pulsar on Kubernetes</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Concerns</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/concerns/PartitionedTopics/"><i class="fa fa-file-text-o"></i>Partitioned topics</a></li>
        
        
        
        <li><a  class="active"
                href="/incubator-pulsar/docs/latest/concerns/RetentionExpiry/"><i class="fa fa-file-text-o"></i>Retention and expiry</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Pulsar administration</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/AdminInterface/"><i class="fa fa-file-text-o"></i>Pulsar admin interface</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/ClustersBrokers/"><i class="fa fa-file-text-o"></i>Clusters and brokers</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/PropertiesNamespaces/"><i class="fa fa-file-text-o"></i>Properties and namespaces</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/ZooKeeperBookKeeper/"><i class="fa fa-file-text-o"></i>ZooKeeper and BookKeeper</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/Dashboard/"><i class="fa fa-file-text-o"></i>Dashboard</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/Authz/"><i class="fa fa-file-text-o"></i>Authentication and authorization</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/GeoReplication/"><i class="fa fa-file-text-o"></i>Geo-replication</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/Stats/"><i class="fa fa-file-text-o"></i>Pulsar statistics</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/admin/ModularLoadManager/"><i class="fa fa-file-text-o"></i>Modular load manager</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Pulsar applications</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/JavaClient/"><i class="fa fa-file-text-o"></i>The Pulsar Java client</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/CppClient/"><i class="fa fa-file-text-o"></i>The Pulsar C++ client</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/PythonClient/"><i class="fa fa-file-text-o"></i>The Pulsar Python client</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/WebSocket/"><i class="fa fa-file-text-o"></i>WebSocket API</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/PulsarSpark/"><i class="fa fa-file-text-o"></i>Spark Streaming receiver</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/PulsarStorm/"><i class="fa fa-file-text-o"></i>Apache Storm adaptor</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/applications/SimulationTools/"><i class="fa fa-file-text-o"></i>Simulation tools</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Developing Pulsar</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/project/BinaryProtocol/"><i class="fa fa-file-text-o"></i>Pulsar binary protocol</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/project/Codebase/"><i class="fa fa-file-text-o"></i>Codebase</a></li>
        
      </ul>
    </section>
    
    <section class="sidebar-group">
      <h4>Reference</h4>
      <ul>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/reference/RestApi/"><i class="fa fa-file-text-o"></i>Pulsar REST API</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/reference/CliTools/"><i class="fa fa-file-text-o"></i>Command-line tools</a></li>
        
        
        
        <li><a 
                href="/incubator-pulsar/docs/latest/reference/Configuration/"><i class="fa fa-file-text-o"></i>Pulsar configuration</a></li>
        
      </ul>
    </section>
    
  </ul>
</aside>


    </nav>

    <article class="col-xs-12 col-sm-12 col-md-7 col-lg-7">
      <section class="docs-header">
        <h1 class="docs-title">Message retention and expiry</h1>
        <span class="docs-lead">Manage how long messages remain stored in your Pulsar instance</span><br />
        <section class="tags">
          
          <!-- <span class="badge badge-pill badge-primary">admin</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-admin">admin</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-admin">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pages with the <strong>admin</strong> tag</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          <li><a href="/docs/latest/admin/AdminInterface/">The Pulsar admin interface</a></li>
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/latest/admin/Authz/">Authentication and authorization in Pulsar</a></li>
          
          
          
          
          
          
          
          <li><a href="/docs/latest/reference/CliTools/">Pulsar command-line tools</a></li>
          
          
          
          
          
          
          
          <li><a href="/docs/latest/admin/ClustersBrokers/">Pulsar cluster and broker administration</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/latest/deployment/InstanceSetup/">Deploying a Pulsar instance</a></li>
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/latest/concerns/PartitionedTopics/">Partitioned topics</a></li>
          
          
          
          <li><a href="/docs/latest/admin/PropertiesNamespaces/">Managing properties and namespaces</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/latest/concerns/RetentionExpiry/">Message retention and expiry</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
          <!-- <span class="badge badge-pill badge-primary">expiry</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-expiry">expiry</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-expiry">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pages with the <strong>expiry</strong> tag</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/latest/concerns/RetentionExpiry/">Message retention and expiry</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
          <!-- <span class="badge badge-pill badge-primary">retention</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-retention">retention</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-retention">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pages with the <strong>retention</strong> tag</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/latest/concerns/RetentionExpiry/">Message retention and expiry</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
          <!-- <span class="badge badge-pill badge-primary">backlog</span> -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-backlog">backlog</button>
          <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="modal fade" id="modal-backlog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pages with the <strong>backlog</strong> tag</h5>
      </div>
      <div class="modal-body">
        <ul>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li><a href="/docs/latest/concerns/RetentionExpiry/">Message retention and expiry</a></li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
        </ul>
      </div>
    </div>
  </div>
</div>

          
        </section>

        <hr class="hr">
      </section>

      <section class="content">
        <p>By default Pulsar <span class="popover-term" tabindex="0" title="What is a broker?" data-placement="top" data-content="A stateless component of Pulsar clusters that runs two other components: an HTTP server exposing a REST interface for administration and topic lookup and a dispatcher that handles all message transers. Pulsar clusters typically consist of multiple brokers." data-toggle="popover" data-trigger="focus">brokers</span> do two things:</p>

<ul>
  <li>They immediately delete all messages that have been <span class="popover-term" tabindex="0" title="What is an acknowledgement (ack)?" data-placement="top" data-content="A message sent to a Pulsar broker by a consumer that a message has been successfully processed. An acknowledgement (ack) is Pulsar's way of knowing that the message can be deleted from the system; if no acknowledgement, then the message will be retained until it's processed." data-toggle="popover" data-trigger="focus">acknowledged</span> by a <span class="popover-term" tabindex="0" title="What is a consumer?" data-placement="top" data-content="A process that establishes a subscription to a Pulsar topic and processes messages published to that topic by producers." data-toggle="popover" data-trigger="focus">consumer</span>.</li>
  <li>They persistently store all unacknowledged messages in a <a href="#backlog-quotas">backlog</a>.</li>
</ul>

<p>Pulsar also enables you to:</p>

<ul>
  <li>persistently store acknowledged messages by setting <a href="#retention-policies">retention policies</a></li>
  <li>delete messages that have not been acknowledged within a specified timeframe using <a href="#time-to-live-ttl">time to live</a> (TTL)</li>
</ul>

<p>Pulsar’s <a href="../../admin/AdminInterface">admin interface</a> enables you to manage both retention policies and TTL at the <span class="popover-term" tabindex="0" title="What is a namespace?" data-placement="top" data-content="TODO" data-toggle="popover" data-trigger="focus">namespace</span> level (and thus within a specific <span class="popover-term" tabindex="0" title="What is a property?" data-placement="top" data-content="TODO" data-toggle="popover" data-trigger="focus">property</span> and on a specific <span class="popover-term" tabindex="0" title="What is a cluster?" data-placement="top" data-content="A set of Pulsar brokers and BookKeeper servers (aka bookies). Clusters can reside in different geographical regions and replicate messages to one another in a process called geo-replication." data-toggle="popover" data-trigger="focus">cluster</span>).</p>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="warning">
    <span class="admonition-title"><p>Don’t use retention and TTL at the same time</p>
</span>
    
<p>Message retention policies and TTL fulfill similar purposes and should not be used in conjunction. For any given namespace, use one or the other.</p>

  </div>
</div>

<h2 id="retention-policies">Retention policies</h2>

<p>By default, when a Pulsar message arrives at a <span class="popover-term" tabindex="0" title="What is a broker?" data-placement="top" data-content="A stateless component of Pulsar clusters that runs two other components: an HTTP server exposing a REST interface for administration and topic lookup and a dispatcher that handles all message transers. Pulsar clusters typically consist of multiple brokers." data-toggle="popover" data-trigger="focus">broker</span> it will be stored until it has been <span class="popover-term" tabindex="0" title="What is an acknowledgement (ack)?" data-placement="top" data-content="A message sent to a Pulsar broker by a consumer that a message has been successfully processed. An acknowledgement (ack) is Pulsar's way of knowing that the message can be deleted from the system; if no acknowledgement, then the message will be retained until it's processed." data-toggle="popover" data-trigger="focus">acknowledged</span> by a <span class="popover-term" tabindex="0" title="What is a consumer?" data-placement="top" data-content="A process that establishes a subscription to a Pulsar topic and processes messages published to that topic by producers." data-toggle="popover" data-trigger="focus">consumer</span>, at which point it will be deleted. You can override this behavior and retain even messages that have already been acknowledged by setting a <em>retention policy</em> on all the topics in a given <span class="popover-term" tabindex="0" title="What is a namespace?" data-placement="top" data-content="TODO" data-toggle="popover" data-trigger="focus">namespace</span>. When you set a retention policy you can set either a <em>size limit</em> or a <em>time limit</em>.</p>

<p>When you set a size limit of, say, 10 gigabytes, then messages in all topics in the namespace, <em>even acknowledged messages</em>, will be retained until the size limit for the topic is reached; if you set a time limit of, say, 1 day, then messages for all topics in the namespace will be retained for 24 hours.</p>

<h3 id="defaults">Defaults</h3>

<p>There are two configuration parameters that you can use to set <span class="popover-term" tabindex="0" title="What is a Pulsar instance?" data-placement="top" data-content="A group of Pulsar clusters that act together as a single unit." data-toggle="popover" data-trigger="focus">instance</span>-wide defaults for message retention: <a href="../../reference/Configuration#broker-defaultRetentionTimeInMinutes"><code class="highlighter-rouge">defaultRetentionTimeInMinutes</code></a> and <a href="../../reference/Configuration#broker-defaultRetentionSizeInMB"><code class="highlighter-rouge">defaultRetentionSizeInMB</code></a>.</p>

<p>Both of these parameters are in the <a href="../../reference/Configuration#broker"><code class="highlighter-rouge">broker.conf</code></a> configuration file.</p>

<h3 id="set-retention-policy">Set retention policy</h3>

<p>You can a retention policy for a namespace by specifying the namespace and either a size limit or a time limit <em>or both a size and time limit</em>.</p>

<h4 id="pulsar-admin">pulsar-admin</h4>

<p>Use the <a href="../../reference/CliTools#pulsar-admin-namespaces-set-retention"><code class="highlighter-rouge">set-retention</code></a> subcommand and specify a namespace and either a size limit using the <code class="highlighter-rouge">-s</code>/<code class="highlighter-rouge">--size</code> flag <em>or</em> a time limit using the <code class="highlighter-rouge">-t</code>/<code class="highlighter-rouge">--time</code> flag.</p>

<h5 id="examples">Examples</h5>

<p>To set a size limit of 10 gigabytes for the <code class="highlighter-rouge">my-prop/my-cluster/my-ns</code> namespace:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>pulsar-admin namespaces <span class="nb">set</span>-retention my-prop/my-cluster/my-ns <span class="se">\</span>
  --size 10G
</code></pre>
</div>

<p>To set a time limit of 3 hours for the <code class="highlighter-rouge">my-prop/my-cluster/my-ns</code> namespace:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>pulsar-admin namespaces <span class="nb">set</span>-retention my-prop/my-cluster/my-ns <span class="se">\</span>
  --time 3h
</code></pre>
</div>

<p>To set a size <em>and</em> time limit:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>pulsar-admin namespaces <span class="nb">set</span>-retention my-prop/my-cluster/my-ns <span class="se">\</span>
  --time 3h <span class="se">\</span>
</code></pre>
</div>

<h4 id="rest-api">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/retention</code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/retention">More info</a></p>

<h4 id="java">Java</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">retentionTime</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span> <span class="c1">// 10 minutes</span>
<span class="kt">int</span> <span class="n">retentionSize</span> <span class="o">=</span> <span class="mi">500</span><span class="o">;</span> <span class="c1">// 500 megabytes</span>
<span class="n">RetentionPolicies</span> <span class="n">policies</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RetentionPolicies</span><span class="o">(</span><span class="n">retentionTime</span><span class="o">,</span> <span class="n">retentionSize</span><span class="o">);</span>
<span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">setRetention</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">policies</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="get-retention-policy">Get retention policy</h3>

<p>You can fetch the retention policy for a namespace by specifying the namespace. The output will be a JSON object with two keys: <code class="highlighter-rouge">retentionTimeInMinutes</code> and <code class="highlighter-rouge">retentionSizeInMB</code>.</p>

<h4 id="pulsar-admin-1">pulsar-admin</h4>

<p>Use the <a href="../../reference/CliTools#pulsar-admin-namespaces-get-retention"><code class="highlighter-rouge">get-retention</code></a> subcommand and specify the namespace.</p>

<h5 id="example">Example</h5>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>pulsar-admin namespaces get-retention my-prop/my-cluster/my-ns
<span class="o">{</span>
  <span class="s2">"retentionTimeInMinutes"</span>: 10,
  <span class="s2">"retentionSizeInMB"</span>: 0
<span class="o">}</span>
</code></pre>
</div>

<h4 id="rest-api-1">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/retention</code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/retention">More info</a></p>

<h4 id="java-1">Java</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getRetention</span><span class="o">(</span><span class="n">namespace</span><span class="o">);</span>
</code></pre>
</div>

<h2 id="backlog-quotas">Backlog quotas</h2>

<p><em>Backlogs</em> are sets of unacknowledged messages for a topic that have been stored by <span class="popover-term" tabindex="0" title="What is a bookie?" data-placement="top" data-content="Bookie is just a nickname for an individual BookKeeper server." data-toggle="popover" data-trigger="focus">bookies</span>. Pulsar stores all unacknowledged messages in backlogs until they are processed and acknowledged.</p>

<p>You can control the allowable size of backlogs, at the <span class="popover-term" tabindex="0" title="What is a namespace?" data-placement="top" data-content="TODO" data-toggle="popover" data-trigger="focus">namespace</span> level, using <em>backlog quotas</em>. Setting a backlog quota involves setting:</p>

<ul>
  <li>an allowable <em>size threshold</em> for each topic in the namespace</li>
  <li>a <em>retention policy</em> that determines which action the <span class="popover-term" tabindex="0" title="What is a broker?" data-placement="top" data-content="A stateless component of Pulsar clusters that runs two other components: an HTTP server exposing a REST interface for administration and topic lookup and a dispatcher that handles all message transers. Pulsar clusters typically consist of multiple brokers." data-toggle="popover" data-trigger="focus">broker</span> takes if the threshold is exceeded.</li>
</ul>

<p>The following retention policies are available:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Policy</th>
      <th style="text-align: left">Action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">producer_request_hold</code></td>
      <td style="text-align: left">The broker will hold and not persist produce request payload</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">producer_exception</code></td>
      <td style="text-align: left">The broker will disconnect from the client by throwing an exception</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">consumer_backlog_eviction</code></td>
      <td style="text-align: left">The broker will begin discarding backlog messages</td>
    </tr>
  </tbody>
</table>

<!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<div class="admonition">
  <div class="warning">
    <span class="admonition-title"><p>Beware the distinction between retention policy types</p>
</span>
    
<p>As you may have noticed, there are two definitions of the term “retention policy” in Pulsar, one that applies to persistent storage of already-acknowledged messages and one that applies to backlogs.</p>

  </div>
</div>

<p>Backlog quotas are handled at the <span class="popover-term" tabindex="0" title="What is a namespace?" data-placement="top" data-content="TODO" data-toggle="popover" data-trigger="focus">namespace</span> level. They can be managed via:</p>

<h3 id="set-size-thresholds-and-backlog-retention-policies">Set size thresholds and backlog retention policies</h3>

<p>You can set a size threshold and backlog retention policy for all of the topics in a <span class="popover-term" tabindex="0" title="What is a namespace?" data-placement="top" data-content="TODO" data-toggle="popover" data-trigger="focus">namespace</span> by specifying the namespace, a size limit, and a policy by name.</p>

<h4 id="pulsar-admin-2">pulsar-admin</h4>

<p>Use the <a href="../../reference/CliTools#pulsar-admin-namespaces-set-backlog-quota"><code class="highlighter-rouge">set-backlog-quota</code></a> subcommand and specify a namespace, a size limit using the <code class="highlighter-rouge">-l</code>/<code class="highlighter-rouge">--limit</code> flag, and a retention policy using the <code class="highlighter-rouge">-p</code>/<code class="highlighter-rouge">--policy</code> flag.</p>

<h5 id="example-1">Example</h5>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>pulsar-admin namespaces <span class="nb">set</span>-backlog-quota my-prop/my-cluster/my-ns <span class="se">\</span>
  --limit 2G <span class="se">\</span>
  --policy producer_request_hold
</code></pre>
</div>

<h4 id="rest-api-2">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/backlogQuota</code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/backlogQuota">More info</a></p>

<h4 id="java-2">Java</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kt">long</span> <span class="n">sizeLimit</span> <span class="o">=</span> <span class="mi">2147483648L</span><span class="o">;</span>
<span class="n">BacklogQuota</span><span class="o">.</span><span class="na">RetentionPolicy</span> <span class="n">policy</span> <span class="o">=</span>
  <span class="n">BacklogQuota</span><span class="o">.</span><span class="na">RetentionPolicy</span><span class="o">.</span><span class="na">producer_request_hold</span><span class="o">;</span>
<span class="n">BacklogQuota</span> <span class="n">quota</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BacklogQuota</span><span class="o">(</span><span class="n">sizeLimit</span><span class="o">,</span> <span class="n">policy</span><span class="o">);</span>
<span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">setBacklogQuota</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">quota</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="get-backlog-threshold-and-backlog-retention-policy">Get backlog threshold and backlog retention policy</h3>

<p>You can see which size threshold and backlog retention policy has been applied to a namespace.</p>

<h4 id="pulsar-admin-3">pulsar-admin</h4>

<p>Use the <a href="../../reference/CliTools#pulsar-admin-namespaces-get-backlog-quotas"><code class="highlighter-rouge">get-backlog-quotas</code></a> subcommand and specify a namespace. Here’s an example:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>pulsar-admin namespaces get-backlog-quotas my-prop/my-cluster/my-ns
<span class="o">{</span>
  <span class="s2">"destination_storage"</span>: <span class="o">{</span>
    <span class="s2">"limit"</span> : 2147483648,
    <span class="s2">"policy"</span> : <span class="s2">"producer_request_hold"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="rest-api-3">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/backlogQuotaMap</code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/backlogQuota">More info</a></p>

<h4 id="java-3">Java</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Map</span><span class="o">&lt;</span><span class="n">BacklogQuota</span><span class="o">.</span><span class="na">BacklogQuotaType</span><span class="o">,</span><span class="n">BacklogQuota</span><span class="o">&gt;</span> <span class="n">quotas</span> <span class="o">=</span>
  <span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">getBacklogQuotas</span><span class="o">(</span><span class="n">namespace</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="remove-backlog-quotas">Remove backlog quotas</h3>

<h4 id="pulsar-admin-4">pulsar-admin</h4>

<p>Use the <a href="../../reference/CliTools#pulsar-admin-namespaces-remove-backlog-quotas"><code class="highlighter-rouge">remove-backlog-quotas</code></a> subcommand and specify a namespace. Here’s an example:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>pulsar-admin namespaces remove-backlog-quotas my-prop/my-cluster/my-ns
</code></pre>
</div>

<h4 id="rest-api-4">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method delete">DELETE</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/backlogQuota</code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/backlogQuota">More info</a></p>

<h4 id="java-4">Java</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">removeBacklogQuota</span><span class="o">(</span><span class="n">namespace</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="clear-backlog">Clear backlog</h3>

<h4 id="pulsar-admin-5">pulsar-admin</h4>

<p>Use the <a href="../../reference/CliTools#pulsar-admin-namespaces-clear-backlog"><code class="highlighter-rouge">clear-backlog</code></a> subcommand.</p>

<h5 id="example-2">Example</h5>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>pulsar-admin namespaces clear-backlog my-prop/my-cluster/my-ns
</code></pre>
</div>

<p>By default, you will be prompted to ensure that you really want to clear the backlog for the namespace. You can override the prompt using the <code class="highlighter-rouge">-f</code>/<code class="highlighter-rouge">--force</code> flag.</p>

<h2 id="time-to-live-ttl">Time to live (TTL)</h2>

<p>By default, Pulsar stores all unacknowledged messages forever. This can lead to heavy disk space usage in cases where a lot of messages are going unacknowledged. If disk space is a concern, you can set a time to live (TTL) that determines how long unacknowledged messages will</p>

<h3 id="set-the-ttl-for-a-namespace">Set the TTL for a namespace</h3>

<h4 id="pulsar-admin-6">pulsar-admin</h4>

<p>Use the <a href="../../reference/CliTools#pulsar-admin-namespaces-set-message-ttl"><code class="highlighter-rouge">set-message-ttl</code></a> subcommand and specify a namespace and a TTL (in seconds) using the <code class="highlighter-rouge">-ttl</code>/<code class="highlighter-rouge">--messageTTL</code> flag.</p>

<h5 id="example-3">Example</h5>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>pulsar-admin namespaces <span class="nb">set</span>-message-ttl my-prop/my-cluster/my-ns <span class="se">\</span>
  --messageTTL 120 <span class="c"># TTL of 2 minutes</span>
</code></pre>
</div>

<h4 id="rest-api-5">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method post">POST</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/messageTTL</code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/messageTTL">More info</a></p>

<h4 id="java-5">Java</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">setNamespaceMessageTTL</span><span class="o">(</span><span class="n">namespace</span><span class="o">,</span> <span class="n">ttlInSeconds</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="get-the-ttl-configuration-for-a-namespace">Get the TTL configuration for a namespace</h3>

<h4 id="pulsar-admin-7">pulsar-admin</h4>

<p>Use the <a href="../../reference/CliTools#pulsar-admin-namespaces-get-message-ttl"><code class="highlighter-rouge">get-message-ttl</code></a> subcommand and specify a namespace.</p>

<h5 id="example-4">Example</h5>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>pulsar-admin namespaces get-message-ttl my-prop/my-cluster/my-ns
60
</code></pre>
</div>

<h4 id="rest-api-6">REST API</h4>

<div class="highlighter-rouge endpoint"><pre class="highlight"><code class="method get">GET</code><code class="url">/admin/namespaces/<span class="endpoint">:property</span>/<span class="endpoint">:cluster</span>/<span class="endpoint">:namespace</span>/messageTTL</code></pre></div>

<p><a href="../../reference/RestApi#/admin/namespaces/:property/:cluster/:namespace/messageTTL">More info</a></p>

<h4 id="java-6">Java</h4>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">admin</span><span class="o">.</span><span class="na">namespaces</span><span class="o">().</span><span class="na">get</span>
</code></pre>
</div>

      </section>
    </article>

    <nav class="toc-bar hidden-sm-down col-md-2 col-lg-2">
      
      <div id="toc">
        <h4>Message retention and expiry</h4>
      </div>
      
    </nav>
  </div>
</div>

      </main>
    </main>

    <!--

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.

-->
<footer class="footer">
  <div class="container">
    <p class="text-center">Copyright 2017 The Apache Software Foundation. All Rights Reserved.</p>
  </div>
</footer>


    

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-102219959-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
